"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.crayonStream = void 0;
const transformer_1 = require("./transformer");
const crayonStream = (opts) => {
    let controller = null;
    const readableStream = new ReadableStream({
        async start(c) {
            controller = c;
        },
    });
    const crayonTransformer = new transformer_1.CrayonDataStreamTransformer(opts);
    const onText = (text) => {
        controller.enqueue(text);
    };
    const onEnd = () => {
        controller.close();
    };
    const onError = (e) => {
        controller.error(e);
    };
    const onLLMEnd = () => {
        crayonTransformer.reset();
    };
    return {
        stream: readableStream.pipeThrough(crayonTransformer),
        onText,
        onEnd,
        onLLMEnd,
        onError,
    };
};
exports.crayonStream = crayonStream;
//# sourceMappingURL=crayonStream.js.map